<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Materials × Properties — Interactive Table</title>
  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#0ea5a4;
      --accent-strong:#028c86;
      --glass: rgba(255,255,255,0.6);
      --radius:12px;
      --shadow: 0 6px 20px rgba(16,24,40,0.08);
    }
    *{box-sizing:border-box}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin:24px;
      background: linear-gradient(180deg, #eef2f7 0%, var(--bg) 100%);
      color:#0f172a;
    }
    .container{
      max-width:980px;
      margin:0 auto;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }
    h1{
      font-size:20px;
      margin:0;
    }
    p.lead{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      overflow:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:640px;
    }
    thead th{
      position:sticky;
      top:0;
      background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(250,250,250,0.9));
      backdrop-filter: blur(6px);
      z-index:2;
      text-align:center;
      padding:10px 8px;
      font-weight:600;
      font-size:13px;
      color:#0f172a;
    }
    thead th .col-title{display:block; margin-bottom:6px}
    thead th .col-controls{font-size:12px; color:var(--muted)}
    tbody td{
      padding:10px 8px;
      border-top:1px solid #f1f5f9;
      text-align:center;
      vertical-align:middle;
      font-size:14px;
    }
    tbody td:first-child{
      text-align:left;
      font-weight:600;
      color:#0b1220;
    }
    tr.row-selected{
      background:linear-gradient(90deg, rgba(14,165,164,0.06), rgba(2,140,134,0.03));
    }
    .checkbox{transform:scale(1.1); margin:0}
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
    }
    button{
      background:var(--accent);
      color:white;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      box-shadow:0 4px 8px rgba(2,140,134,0.12);
    }
    button.ghost{
      background:transparent;
      color:var(--accent-strong);
      box-shadow:none;
      border:1px solid rgba(2,140,134,0.12);
    }
    .meta{
      margin-top:12px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:13px;
    }
    .count-badge{
      background:#f1f5f9;
      padding:6px 8px;
      border-radius:999px;
      font-weight:700;
      color:var(--muted);
      font-size:13px;
    }
    @media (max-width:720px){
      thead th, tbody td{padding:8px 6px; font-size:13px}
      .controls{flex-direction:column; align-items:flex-end}
      header{flex-direction:column; align-items:flex-start; gap:6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Materials × Properties</h1>
        <p class="lead">Tick boxes to mark which materials have which properties. Selections persist locally and can be exported to CSV.</p>
      </div>
      <div class="controls" role="region" aria-label="Table controls">
        <button id="exportBtn" title="Export table as CSV">Export CSV</button>
        <button id="resetBtn" class="ghost" title="Clear all selections">Reset</button>
      </div>
    </header>

    <div class="card" role="application" aria-label="Materials properties table">
      <table id="propsTable" aria-describedby="tableDesc">
        <caption id="tableDesc" style="display:none">Interactive table showing materials and whether they are flexible, waterproof, strong, or transparent.</caption>
        <thead>
          <tr>
            <th scope="col">Material</th>
            <th scope="col">
              <span class="col-title">Flexible</span>
              <label class="col-controls">
                <input id="col-flexible" class="checkbox col-toggle" type="checkbox" aria-label="Select all Flexible" />
                <div style="font-size:12px;color:var(--muted)">All</div>
              </label>
            </th>
            <th scope="col">
              <span class="col-title">Waterproof</span>
              <label class="col-controls">
                <input id="col-waterproof" class="checkbox col-toggle" type="checkbox" aria-label="Select all Waterproof" />
                <div style="font-size:12px;color:var(--muted)">All</div>
              </label>
            </th>
            <th scope="col">
              <span class="col-title">Strong</span>
              <label class="col-controls">
                <input id="col-strong" class="checkbox col-toggle" type="checkbox" aria-label="Select all Strong" />
                <div style="font-size:12px;color:var(--muted)">All</div>
              </label>
            </th>
            <th scope="col">
              <span class="col-title">Transparent</span>
              <label class="col-controls">
                <input id="col-transparent" class="checkbox col-toggle" type="checkbox" aria-label="Select all Transparent" />
                <div style="font-size:12px;color:var(--muted)">All</div>
              </label>
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows will be injected by JS -->
        </tbody>
      </table>

      <div class="meta" aria-live="polite" id="counts">
        <!-- Column counts injected here -->
      </div>
    </div>
  </div>

  <script>
    (function(){
      const materials = ['metal','paper','fabric','rubber','glass','plastic'];
      const properties = ['flexible','waterproof','strong','transparent'];
      const tableBody = document.querySelector('#propsTable tbody');
      const countsEl = document.getElementById('counts');
      const storageKey = 'materialsPropertiesSelections_v1';

      // Load saved state from localStorage if present
      let state = loadState();

      // Build table rows
      function buildRows(){
        tableBody.innerHTML = '';
        materials.forEach((mat, rIndex) => {
          const tr = document.createElement('tr');
          tr.dataset.material = mat;
          // Material name cell
          const nameTd = document.createElement('td');
          nameTd.textContent = mat.charAt(0).toUpperCase() + mat.slice(1);
          tr.appendChild(nameTd);

          properties.forEach((prop, cIndex) => {
            const td = document.createElement('td');
            const id = `cb_${mat}_${prop}`;
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.className = 'checkbox cell-checkbox';
            input.id = id;
            input.dataset.material = mat;
            input.dataset.property = prop;
            input.setAttribute('aria-label', `${mat} is ${prop}`);
            // Set from state
            input.checked = !!(state[mat] && state[mat][prop]);

            input.addEventListener('change', onCellChange);
            td.appendChild(input);
            tr.appendChild(td);
          });

          tableBody.appendChild(tr);
        });
        refreshRowHighlights();
        refreshCounts();
      }

      function onCellChange(e){
        const cb = e.target;
        const mat = cb.dataset.material;
        const prop = cb.dataset.property;
        // update state
        if(!state[mat]) state[mat] = {};
        state[mat][prop] = cb.checked;
        saveState();
        refreshRowHighlights();
        refreshCounts();
        refreshColumnMaster(prop);
      }

      // Column master toggles
      document.querySelectorAll('.col-toggle').forEach(el => {
        el.addEventListener('change', (e) => {
          const id = e.target.id; // e.g. col-flexible
          const prop = id.replace(/^col-/,'');
          const checked = e.target.checked;
          document.querySelectorAll(`.cell-checkbox[data-property="${prop}"]`).forEach(cb => {
            cb.checked = checked;
            if(!state[cb.dataset.material]) state[cb.dataset.material] = {};
            state[cb.dataset.material][prop] = checked;
          });
          saveState();
          refreshRowHighlights();
          refreshCounts();
        });
      });

      // Update the column master checkbox if all items are selected / some selected
      function refreshColumnMaster(prop){
        const all = Array.from(document.querySelectorAll(`.cell-checkbox[data-property="${prop}"]`));
        const checkedCount = all.filter(cb => cb.checked).length;
        const master = document.getElementById('col-' + prop);
        if(!master) return;
        master.indeterminate = checkedCount > 0 && checkedCount < all.length;
        master.checked = checkedCount === all.length;
      }

      // Row highlight if any checked
      function refreshRowHighlights(){
        document.querySelectorAll('#propsTable tbody tr').forEach(tr => {
          const anyChecked = tr.querySelectorAll('.cell-checkbox:checked').length > 0;
          tr.classList.toggle('row-selected', anyChecked);
        });
        // update column masters for all columns
        properties.forEach(refreshColumnMaster);
      }

      // Column counts displayed in meta area
      function refreshCounts(){
        const counts = {};
        properties.forEach(prop => counts[prop] = 0);
        materials.forEach(mat => {
          properties.forEach(prop => {
            if(state[mat] && state[mat][prop]) counts[prop]++;
          });
        });
        countsEl.innerHTML = properties.map(prop =>
          `<div class="count-badge" title="${counts[prop]} materials are ${prop}">${prop.charAt(0).toUpperCase()+prop.slice(1)}: ${counts[prop]}</div>`
        ).join('');
      }

      // Save/load state
      function saveState(){ localStorage.setItem(storageKey, JSON.stringify(state)); }
      function loadState(){
        try{
          const raw = localStorage.getItem(storageKey);
          return raw ? JSON.parse(raw) : {};
        }catch(e){ return {}; }
      }

      // Export CSV
      function exportCSV(){
        const header = ['Material', ...properties.map(p => p.charAt(0).toUpperCase()+p.slice(1))];
        const rows = materials.map(mat => {
          const values = properties.map(p => (state[mat] && state[mat][p]) ? '1' : '0');
          return [mat.charAt(0).toUpperCase()+mat.slice(1), ...values].join(',');
        });
        const csv = [header.join(','), ...rows].join('\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'materials-properties.csv';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      // Reset all
      function resetAll(){
        if(!confirm('Clear all selections?')) return;
        state = {};
        saveState();
        document.querySelectorAll('.cell-checkbox').forEach(cb => cb.checked = false);
        document.querySelectorAll('.col-toggle').forEach(cb => { cb.checked = false; cb.indeterminate = false;});
        refreshRowHighlights();
        refreshCounts();
      }

      // Hook up buttons
      document.getElementById('exportBtn').addEventListener('click', exportCSV);
      document.getElementById('resetBtn').addEventListener('click', resetAll);

      // Initialize UI
      buildRows();

      // Accessibility: allow keyboard focus outlines on checkboxes
      document.addEventListener('keydown', e => {
        if(e.key === 'Tab') document.body.classList.add('user-is-tabbing');
      });

    })();
  </script>
</body>
</html>
